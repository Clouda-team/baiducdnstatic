!function(t,a){"function"==typeof define&&define.amd?define(a):t.TemplateInit=a()}(this,function(){if(!jQuery||!Handlebars)throw new Error("jQuery & Handlebars are both needed for template-init!");var t=jQuery,a={append:!1,sourceMethod:"get",sourceData:function(){return{}},page:{size:"page.size",to:"page.pn"},nonResult:'<div class="no-content" style="padding-top: 150px;"><span class="nocon-bid"></span><span class="nocon-detail">暂无内容！</span></div>'};return jQuery.fn.toPager=function(a){return t(this).each(function(){function e(t){return'<a class="pagination-spec" data-page="'+t+'">'+t+"</a>"}function n(t){r.currentPage=Number(t),o.toPager(r,!0),o.trigger("switch",{toPage:r.currentPage})}var i,o=t(this),r=t.extend({el:o,totalPage:1,currentPage:1,preposePagesCount:1,postposePagesCount:1,firstPagesCount:2,lastPagesCount:2,"switch":null},a),s="",p=r.totalPage,l=r.currentPage,c=r.preposePagesCount,g=r.postposePagesCount,u=r.firstPagesCount,d=r.lastPagesCount;if(s+=1===l?'<span class="pagination-start"><span>上一页</span></span>':'<a class="pagination-prev"><span>上一页</span></a>',u+c+1>=l)for(var h=1;l>h;h++)s+=e(h);else{for(var h=1;u>=h;h++)s+=e(h);s+='<span class="pagination-break">...</span>';for(var h=l-c;l-1>=h;h++)s+=e(h)}if(s+='<span class="pagination-curr">'+l+"</span>",l>=p-d-g){i=l+1;for(var h=l+1;p>=h;h++)s+=e(h)}else{for(var h=l+1;l+g>=h;h++)s+=e(h);s+='<span class="pagination-break">...</span>';for(var h=p-d+1;p>=h;h++)s+=e(h)}p=0===p?1:p,s+=l===p?'<span class="pagination-end"><span>下一页</span></span>':'<a class="pagination-next"><span>下一页</span></a>',t(r.el).html(s),o.off("switch").on("switch",r["switch"]),t(r.el).off("click").on("click",".pagination-spec",function(){n(t(this).html())}).on("click",".pagination-prev",function(){n(Number(t(this).siblings(".pagination-curr").html())-1)}).on("click",".pagination-next",function(){n(Number(t(this).siblings(".pagination-curr").html())+1)})})},Handlebars.registerHelper("division",function(t,a){return t/a}),{__simple__:function(a,e){"function"==typeof a.begin&&a.begin.call(this,a,e);var n=t(a.tmpl).html(),i=t(a.target),o=Handlebars.compile(n)(a.source),r=t("<div>"+o+"</div>"),s=r.children(".currentPage").hide().html(),p=Math.ceil(r.children(".totalPage").hide().html());t(a.pagination).hide(),0===p&&r.html(a.nonResult),a.prepend?i.prepend(r.html()):a.append?i.append(r.html()):i.html(r.html());var l=null;a.pagination&&("0"!=p&&t(a.pagination).show(),a.url=location.href.replace(new RegExp("([?])?[&]?"+a.page.to+"=\\w*&?"),"$1"),l=t(a.pagination).toPager({currentPage:Math.floor(s)||1,totalPage:0|p},!e),"function"==typeof a.callback?a.callback.call(this,a,l,e):l&&e&&l.on("switch",function(t,e){location.href=a.url+(a.url.indexOf("?")>-1?"&"+a.page.to+"="+e.toPage:"?"+a.page.to+"="+e.toPage)}))},__ajax__:function(a,e){var n=t(a.tmpl).html(),i=t(a.target),o="post"==a.sourceMethod?"post":"get",r=this;"function"==typeof a.before?a.before.call(r,a,e):a.prepend||a.append||(i.html(""),i.append(t('<div class="list-wait">等待中...</div>')));var s={};"get"===o&&(s.t=(new Date).getTime()),a.pagination&&(s[a.page.to]=a.toPage||1,s[a.page.size]=10),t[o](a.sourceUrl,t.extend(s,a.sourceData()),function(o){if(o.code&&200!=o.code)return void i.html(a.nonResult);t(a.pagination).hide(),a.source=o,"function"==typeof a.begin&&a.begin.call(r,a,e);var s=Handlebars.compile(n)(a.source),p=t("<div>"+s+"</div>"),l=p.children(".currentPage").hide().html(),c=Math.ceil(p.children(".totalPage").hide().html());0===c&&p.html(a.nonResult),p.children(".currentPage").remove(),p.children(".totalPage").remove(),p.remove(".list-wait"),a.prepend?i.prepend(p.html()):a.append?i.append(p.html()):i.html(p.html());var g=null;a.pagination&&(g=t(a.pagination).toPager({currentPage:Math.floor(l)||1,totalPage:0|c,"switch":function(e,n){a.toPage=n.toPage,t(this).hide(),r.__ajax__(a)}},!e),"0"!=c&&g.show()),"function"==typeof a.callback&&a.callback.call(r,a,g,e)},a.dataType||"json")},__init__:function(e,n){var i=t(e.tmpl),o=this;return i.each(function(){var i=t(this),r=t.extend(t.extend({},a),{sourceUrl:i.attr("data-url"),target:i.attr("data-target"),append:i.attr("data-append"),prepend:i.attr("data-prepend"),pagination:i.attr("data-pagination"),sourceMethod:i.attr("data-method"),dataType:i.attr("data-type")},e);r.sourceUrl?o.__ajax__(r,n):o.__simple__(r,n)})},init:function(t){return this.__init__(t,!0)},refresh:function(t){return this.__init__(t,!1)}}});